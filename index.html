<html>
<head>
<title>World Data, summarised</title>
<script src="d3.v3.js" charset="utf-8"></script>
<script src="data.json" charset="utf-8"></script>
<link rel="stylesheet" href="world.css"/>
<script>
//Stuff!
function doStuff(){
    var height=630,
    width=1260;
    var toBorder = loadCoords(data);
    var borders = getBorders(data,toBorder);

    var zoom=d3.behavior.zoom()
        .on("zoom",function(){console.log("zoomed");});
 
    var visualisation=d3.select("#world").append("svg")
        .attr("width", width)
        .attr("height",height)
        .append("g")
        .attr("transform","translate("+(width/2)+","+(height/2)+")")
        .call(zoom);
    visualisation.append("rect")
        .attr("x",-width/2)
        .attr("y",-height/2)
        .attr("width",width)
        .attr("height",height)
        .attr("fill","white");

    var borders=visualisation.selectAll("line")
        .data(borders)
        .enter().append("line")
        .attr("x1",function(d){return latitude(d['source']);})
        .attr("y1",function(d){return longitude(d['source']);})
        .attr("x2",function(d){return latitude(d['target']===undefined?d['source']:d['target']);})
        .attr("y2",function(d){return longitude(d['target']===undefined?d['source']:d['target']);})
        .attr("stroke","blue")
        .attr("stroke-width",1);
    var circle=visualisation.selectAll("circle")
        .data(data)
        .enter().append("circle")
        .attr("cy", function(d){return longitude(d.coords);})
        .attr("cx", function(d){return latitude(d.coords);})
        //.attr("r",function(d){return Math.max(1,Math.sqrt(d.pop/1000000));})
        .attr("r",function(d){return Math.max(1,Math.sqrt(d.area/10000));})
        .append("title")
        .text(function(d){return d.name + "\nArea: " + d.area.toLocaleString() +"km\xb2\nPopulation: "+d.pop.toLocaleString();})
        .on("mouseover", displayData)
        .on("mouseout", removeData);
        
}
function getBorders(d, coords){
    var borders=[];
    d.forEach(function(country) {
        borders = borders.concat(country.borders.map(function(border) {
             return {
               sourcename: country.name,
               source: country.coords,
               target: coords[border],
               targetname: border
             }
        }));
    });
    return borders
}
function displayData(d){
    document.getElementById('tooltip')
}
function removeData(d) {
}

function latitude(d){
    return d[1]*3.5;
}
function longitude(d){
    return d[0]*-3.5;
}

function loadCoords(d) {
    var coords = {};
    d.forEach(function(country) {
      coords[country.name] = country.coords
    });
    return coords;
}
</script>
<script>
window.onload=function(){
    doStuff();
}
</script>
</head>
<body>
<h1> Country Graph </h1>
Data from Wikipedia, CIA World Factbook
<div id="world"></div>
<div id="tooltip" style="position:absolute;">tooltip</div>
</body></html>
